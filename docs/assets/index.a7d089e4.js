const L=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function i(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerpolicy&&(o.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?o.credentials="include":t.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(t){if(t.ep)return;t.ep=!0;const o=i(t);fetch(t.href,o)}};L();const r=document.querySelector.bind(document);document.querySelectorAll.bind(document);const a=document.querySelector("#canvas"),y=a.getContext("2d");function E(e){a.height=e.height,a.width=e.width,y.drawImage(e,0,0)}function M(e,n){const{x:i,y:c,w:t,h:o}=n;a.width=t,a.height=o;const s=[i,c,t,o],d=[0,0,t,o];y.drawImage(e,...s,...d)}function A(e="crop.jpg"){a.toBlob(n=>{const i=URL.createObjectURL(n),c=document.createElement("a");c.href=i,c.download=e,c.click(),URL.revokeObjectURL(i)})}const k=r("#file-button"),v=r("#file-input"),w=r("#file-title"),O=r("#file-area"),$=r("#crop-area");async function x(e){_app.img=await createImageBitmap(e),E(_app.img),w.textContent=e.name,w.contentEditable="true",O.classList.add("hidden"),$.classList.remove("hidden")}k.addEventListener("click",e=>{v.click()});v.addEventListener("change",function(e){this.files.length&&x(this.files[0])});const f=r("#file-drop-overlay");window.addEventListener("dragenter",e=>f.setAttribute("open",""));f.addEventListener("dragleave",e=>f.removeAttribute("open"));window.addEventListener("dragover",e=>e.preventDefault());window.addEventListener("drop",e=>{e.preventDefault(),x(e.dataTransfer.files[0])});const b=r("#crop-area"),u=r("#selection"),l={};b.addEventListener("pointerdown",e=>{l.x=e.clientX,l.y=e.clientY,u.setAttribute("selecting","")});window.addEventListener("pointermove",e=>{if(!u.hasAttribute("selecting"))return;const n=b.getBoundingClientRect(),i=Math.floor(Math.min(Math.max(l.x,e.clientX),n.right)-n.x),c=Math.floor(Math.min(Math.max(l.y,e.clientY),n.bottom)-n.y),t=Math.floor(Math.max(Math.min(l.x,e.clientX),n.left)-n.x),o=Math.floor(Math.max(Math.min(l.y,e.clientY),n.top)-n.y),s=i-t,d=c-o,p=t,h=o,m=Math.floor(n.width)/a.width,g=Math.floor(n.height)/a.height;_app.dims={x:p/m,y:h/g,w:s/m,h:d/g},u.style.cssText=`
    transform: translate(${p}px, ${h}px);
    width: ${s}px;
    height: ${d}px;
  `});window.addEventListener("pointerup",e=>{u.removeAttribute("selecting")});const B=r("#selection"),I=r("#crop-button"),_=r("#download-button"),R=r("#file-title");I.addEventListener("click",e=>{const{img:n,dims:i}=_app;n&&i&&"x"in i&&(M(n,i),B.removeAttribute("style"))});_.addEventListener("click",e=>{_app.img&&A(R.textContent.trim())});window._app={};
